DELIMITER $$

DROP PROCEDURE IF EXISTS ver_area_activo $$
CREATE PROCEDURE ver_area_activo(
    in _nombre VARCHAR(100))
BEGIN
    SELECT *
    FROM area
    WHERE activo_area = 1 AND nombre_area = _nombre;
END $$
DELIMITER ;

-----------------------------------------

DELIMITER $$

DROP PROCEDURE IF EXISTS REGISTRAR_AREA $$
CREATE PROCEDURE REGISTRAR_AREA(
        IN _nombre_area VARCHAR(100) ,
        IN _centro VARCHAR(12)
    )
BEGIN
    CALL insertar_area(
        _nombre_area,
        1 ,
        _centro);
END $$

DELIMITER ;

-------------------------------------

DELIMITER $$

DROP PROCEDURE IF EXISTS CONTEO_AREA_CENTRO $$
CREATE PROCEDURE CONTEO_AREA_CENTRO (
        IN _id_centro VARCHAR(10),
        IN _filtro VARCHAR(140)
    )
BEGIN
    IF (_filtro IS null OR _filtro = "") THEN(
        SELECT COUNT(id_area) as conteo
        FROM  area
        WHERE id_centro_area = _id_centro AND activo_area = 1);
    ELSE 
        SELECT COUNT(id_area) as conteo
        FROM  area
        WHERE id_centro_area = _id_centro AND activo_area = 1 AND 
            (LOWER(id_area) REGEXP LOWER(_filtro) OR
            LOWER(nombre_area) REGEXP LOWER(_filtro) OR
            LOWER(id_centro_area) REGEXP LOWER(_filtro));
    END IF;
END $$

-------------------------------------------------

DELIMITER $$

DROP PROCEDURE IF EXISTS VER_AREAS_CENTRO $$
CREATE PROCEDURE VER_AREAS_CENTRO (
        IN _id_centro VARCHAR(10),
        IN _pagina INT,
        IN _areaXpagina INT,
        IN _search VARCHAR(140)
    )
BEGIN
    DECLARE _inicio INT;
    SET _inicio = (_pagina - 1) * _areaXpagina;
    IF (_search IS null OR _search = "") THEN(
        SELECT 
            id_area ,
            nombre_area ,
            id_centro_area
        FROM area
        WHERE id_centro_area = _id_centro AND activo_area = 1
        LIMIT _inicio, _areaXpagina );
    ELSE
        SELECT 
            id_area ,
            nombre_area ,
            id_centro_area
        FROM area
        WHERE id_centro_area = _id_centro AND activo_area = 1 AND
        (LOWER(id_area) REGEXP LOWER(_search) OR
        LOWER(nombre_area) REGEXP LOWER(_search) OR
        LOWER(id_centro_area) REGEXP LOWER(_search))
        LIMIT _inicio, _areaXpagina;
    END IF;
END $$

DELIMITER ;e